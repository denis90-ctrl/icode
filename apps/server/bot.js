require('dotenv').config();
const { Telegraf } = require('telegraf');

const bot = new Telegraf(process.env.BOT_TOKEN);

// ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ /start
bot.start((ctx) => {
  const welcomeMessage = `ðŸŽ‰ Ð”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ Ð² ÑˆÐºÐ¾Ð»Ñƒ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ iKODe!

ðŸš€ ÐœÑ‹ Ð¾Ð±ÑƒÑ‡Ð°ÐµÐ¼ Ð´ÐµÑ‚ÐµÐ¹ ÑÐ¾Ð·Ð´Ð°Ð²Ð°Ñ‚ÑŒ:
â€¢ Ð˜Ð³Ñ€Ñ‹ Ð² Roblox Studio
â€¢ 3D Ð¼Ð¾Ð´ÐµÐ»Ð¸ Ð¸ Ð°Ð½Ð¸Ð¼Ð°Ñ†Ð¸Ð¸  
â€¢ ÐœÐ¾Ð±Ð¸Ð»ÑŒÐ½Ñ‹Ðµ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ
â€¢ Ð’ÐµÐ±-ÑÐ°Ð¹Ñ‚Ñ‹

ðŸ’¡ ÐŸÐµÑ€Ð²Ñ‹Ð¹ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ ÑƒÐ¶Ðµ Ð½Ð° 1-2 Ð·Ð°Ð½ÑÑ‚Ð¸Ð¸!

ðŸ“± ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Ð½Ð°ÑˆÐµ Ð¼Ð¸Ð½Ð¸-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ, Ñ‡Ñ‚Ð¾Ð±Ñ‹:
1. ÐŸÑ€Ð¾Ð¹Ñ‚Ð¸ ÐºÐ²Ð¸Ð· Ð¸ ÑƒÐ·Ð½Ð°Ñ‚ÑŒ Ð¿Ð¾Ð´Ñ…Ð¾Ð´ÑÑ‰ÐµÐµ Ð½Ð°Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ
2. Ð—Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒÑÑ Ð½Ð° Ð¿Ñ€Ð¾Ð±Ð½Ð¾Ðµ Ð·Ð°Ð½ÑÑ‚Ð¸Ðµ
3. ÐŸÐ¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ Ñ‚Ð°Ñ€Ð¸Ñ„Ñ‹

ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ ÐºÐ½Ð¾Ð¿ÐºÑƒ "ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¼Ð¸Ð½Ð¸-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ" Ð½Ð¸Ð¶Ðµ ðŸ‘‡`;

  ctx.reply(welcomeMessage, {
    reply_markup: {
      inline_keyboard: [
        [{
          text: "ðŸŽ¯ ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¼Ð¸Ð½Ð¸-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ",
          web_app: { url: "https://denis90-ctrl.github.io/icode/" }
        }],
        [{
          text: "ðŸ“ž Ð¡Ð²ÑÐ·Ð°Ñ‚ÑŒÑÑ Ñ Ð¼ÐµÐ½ÐµÐ´Ð¶ÐµÑ€Ð¾Ð¼",
          callback_data: "contact_manager"
        }],
        [{
          text: "â„¹ï¸ Ðž ÑˆÐºÐ¾Ð»Ðµ",
          callback_data: "about_school"
        }]
      ]
    }
  });
});

// ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° callback ÐºÐ½Ð¾Ð¿Ð¾Ðº
bot.action('contact_manager', (ctx) => {
  ctx.reply(`ðŸ“ž Ð¡Ð²ÑÐ¶Ð¸Ñ‚ÐµÑÑŒ Ñ Ð½Ð°Ð¼Ð¸:

ðŸ‘¨â€ðŸ’¼ ÐœÐµÐ½ÐµÐ´Ð¶ÐµÑ€: @icode_manager
ðŸ“§ Email: info@icode.school
ðŸŒ Ð¡Ð°Ð¹Ñ‚: https://icode.school

â° Ð’Ñ€ÐµÐ¼Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹: ÐŸÐ½-ÐŸÑ‚ 9:00-18:00`);
});

bot.action('about_school', (ctx) => {
  ctx.reply(`ðŸ« Ðž ÑˆÐºÐ¾Ð»Ðµ iKODe:

ðŸŽ¯ ÐœÐ¸ÑÑÐ¸Ñ: Ð Ð°Ð·Ð²Ð¸Ð²Ð°Ñ‚ÑŒ Ð¸Ð½Ñ‚ÐµÑ€ÐµÑ Ðº Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸ÑŽ Ñ‡ÐµÑ€ÐµÐ· Ð¿Ñ€Ð°ÐºÑ‚Ð¸ÐºÑƒ

âœ… Ð§Ñ‚Ð¾ Ð´Ð°Ñ‘Ð¼:
â€¢ Ð˜Ð½Ñ‚ÐµÑ€ÐµÑ Ð±ÐµÐ· Ð±Ð¾Ñ€ÑŒÐ±Ñ‹
â€¢ ÐžÑÑÐ·Ð°ÐµÐ¼Ñ‹Ð¹ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð½Ð° 1-2 Ð·Ð°Ð½ÑÑ‚Ð¸Ð¸
â€¢ Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð°Ñ ÑÑ€ÐµÐ´Ð° Ð¾Ð±ÑƒÑ‡ÐµÐ½Ð¸Ñ
â€¢ ÐžÐ¿Ñ‹Ñ‚Ð½Ñ‹Ðµ Ð½Ð°ÑÑ‚Ð°Ð²Ð½Ð¸ÐºÐ¸ Ñ€ÑÐ´Ð¾Ð¼

ðŸŽ® ÐÐ°Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ:
â€¢ Roblox/Ð³ÐµÐ¹Ð¼-Ð´Ð¸Ð·Ð°Ð¹Ð½
â€¢ 3D-Ð¼Ð¾Ð´ÐµÐ»Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ
â€¢ Web-Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ°
â€¢ ÐœÐ¾Ð±Ð¸Ð»ÑŒÐ½Ñ‹Ðµ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ

ðŸ‘¶ Ð’Ð¾Ð·Ñ€Ð°ÑÑ‚: 6-17 Ð»ÐµÑ‚
ðŸ“š Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚: ÐžÑ‡Ð½Ð¾ Ð¸ Ð¾Ð½Ð»Ð°Ð¹Ð½`);
});

// ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¸Ð· Ð¼Ð¸Ð½Ð¸-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ
bot.on('web_app_data', (ctx) => {
  try {
    const data = JSON.parse(ctx.message.web_app_data.data);
    console.log('ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¸Ð· Ð¼Ð¸Ð½Ð¸-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ:', data);
    
    switch (data.type) {
      case 'quiz_result':
        handleQuizResult(ctx, data);
        break;
      case 'trial_request':
        handleTrialRequest(ctx, data);
        break;
      case 'tariff_choice':
        handleTariffChoice(ctx, data);
        break;
      default:
        console.log('ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ð¹ Ñ‚Ð¸Ð¿ Ð´Ð°Ð½Ð½Ñ‹Ñ…:', data.type);
    }
  } catch (error) {
    console.error('ÐžÑˆÐ¸Ð±ÐºÐ° Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ñ…:', error);
    ctx.reply('âŒ ÐŸÑ€Ð¾Ð¸Ð·Ð¾ÑˆÐ»Ð° Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐµ Ð´Ð°Ð½Ð½Ñ‹Ñ…. ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ ÐµÑ‰Ñ‘ Ñ€Ð°Ð·.');
  }
});

// ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð° ÐºÐ²Ð¸Ð·Ð°
function handleQuizResult(ctx, data) {
  const trackNames = {
    R: "Roblox/Ð³ÐµÐ¹Ð¼-Ð´Ð¸Ð·Ð°Ð¹Ð½",
    D: "3D-Ð¼Ð¾Ð´ÐµÐ»Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ",
    W: "Web-Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ°",
    A: "ÐœÐ¾Ð±Ð¸Ð»ÑŒÐ½Ñ‹Ðµ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ"
  };
  
  const levelNames = {
    Starter: "ÐÐ°Ñ‡Ð¸Ð½Ð°ÑŽÑ‰Ð¸Ð¹",
    Explorer: "Ð˜ÑÑÐ»ÐµÐ´Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ", 
    Builder: "Ð¡Ñ‚Ñ€Ð¾Ð¸Ñ‚ÐµÐ»ÑŒ",
    Creator: "Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÐµÐ»ÑŒ"
  };
  
  const message = `ðŸŽ¯ Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ ÐºÐ²Ð¸Ð·Ð°:

ðŸ‘¶ Ð’Ð¾Ð·Ñ€Ð°ÑÑ‚: ${data.ageBucket}
ðŸŽ® Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÐ¼Ñ‹Ð¹ Ñ‚Ñ€ÐµÐº: ${trackNames[data.recommended]}
ðŸ“Š Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ: ${levelNames[data.level]}
â° Ð£Ð´Ð¾Ð±Ð½Ð¾Ðµ Ð²Ñ€ÐµÐ¼Ñ: ${data.timePreference}

ðŸ“ˆ Ð‘Ð°Ð»Ð»Ñ‹ Ð¿Ð¾ Ñ‚Ñ€ÐµÐºÐ°Ð¼:
â€¢ Roblox: ${data.scores.R}
â€¢ 3D: ${data.scores.D}
â€¢ Web: ${data.scores.W}
â€¢ Apps: ${data.scores.A}

ðŸ’¡ Ð¡Ð»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ð¹ ÑˆÐ°Ð³: Ð—Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒÑÑ Ð½Ð° Ð¿Ñ€Ð¾Ð±Ð½Ð¾Ðµ Ð·Ð°Ð½ÑÑ‚Ð¸Ðµ!`;

  ctx.reply(message, {
    reply_markup: {
      inline_keyboard: [
        [{
          text: "ðŸ“ Ð—Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒÑÑ Ð½Ð° Ð¿Ñ€Ð¾Ð±Ð½Ð¾Ðµ",
          callback_data: "book_trial"
        }],
        [{
          text: "ðŸ’° ÐŸÐ¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ Ñ‚Ð°Ñ€Ð¸Ñ„Ñ‹",
          callback_data: "view_tariffs"
        }]
      ]
    }
  });
}

// ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð·Ð°ÑÐ²ÐºÐ¸ Ð½Ð° Ð¿Ñ€Ð¾Ð±Ð½Ð¾Ðµ
function handleTrialRequest(ctx, data) {
  const message = `ðŸ“ ÐÐ¾Ð²Ð°Ñ Ð·Ð°ÑÐ²ÐºÐ° Ð½Ð° Ð¿Ñ€Ð¾Ð±Ð½Ð¾Ðµ Ð·Ð°Ð½ÑÑ‚Ð¸Ðµ!

ðŸ‘¤ Ð¤Ð˜Ðž: ${data.fio}
ðŸ“± Ð¢ÐµÐ»ÐµÑ„Ð¾Ð½: ${data.phone}
ðŸ‘¶ Ð’Ð¾Ð·Ñ€Ð°ÑÑ‚: ${data.age}
ðŸŽ® Ð¢Ñ€ÐµÐº: ${data.track}
â° Ð’Ñ€ÐµÐ¼Ñ: ${data.time}
ðŸ“± Ð˜ÑÑ‚Ð¾Ñ‡Ð½Ð¸Ðº: ${data.source}

âœ… Ð—Ð°ÑÐ²ÐºÐ° Ð¿Ñ€Ð¸Ð½ÑÑ‚Ð°! ÐœÐµÐ½ÐµÐ´Ð¶ÐµÑ€ ÑÐ²ÑÐ¶ÐµÑ‚ÑÑ Ð² Ñ‚ÐµÑ‡ÐµÐ½Ð¸Ðµ 2 Ñ‡Ð°ÑÐ¾Ð².`;

  ctx.reply(message, {
    reply_markup: {
      inline_keyboard: [
        [{
          text: "ðŸ“ž Ð¡Ð²ÑÐ·Ð°Ñ‚ÑŒÑÑ ÑÐµÐ¹Ñ‡Ð°Ñ",
          callback_data: "contact_now"
        }],
        [{
          text: "ðŸ’° ÐŸÐ¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ Ñ‚Ð°Ñ€Ð¸Ñ„Ñ‹",
          callback_data: "view_tariffs"
        }]
      ]
    }
  });
  
  // Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÑÐµÐ¼ Ð¼ÐµÐ½ÐµÐ´Ð¶ÐµÑ€Ð°
  // ctx.telegram.sendMessage(ADMIN_ID, `ðŸš¨ ÐÐžÐ’ÐÐ¯ Ð—ÐÐ¯Ð’ÐšÐ!\n${message}`);
}

// ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð²Ñ‹Ð±Ð¾Ñ€Ð° Ñ‚Ð°Ñ€Ð¸Ñ„Ð°
function handleTariffChoice(ctx, data) {
  const tariffNames = {
    start: "Ð¡Ñ‚Ð°Ñ€Ñ‚ (Ð²Ð²Ð¾Ð´Ð½Ñ‹Ð¹ + 4 Ð·Ð°Ð½ÑÑ‚Ð¸Ñ)",
    base: "Ð‘Ð°Ð·Ð° (8 Ð·Ð°Ð½ÑÑ‚Ð¸Ð¹ + Ð¿Ñ€Ð¾ÐµÐºÑ‚)",
    pro: "ÐŸÑ€Ð¾ (12 Ð·Ð°Ð½ÑÑ‚Ð¸Ð¹ + 2 Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°)"
  };
  
  const message = `ðŸ’° Ð’Ñ‹Ð±Ñ€Ð°Ð½ Ñ‚Ð°Ñ€Ð¸Ñ„: ${tariffNames[data.tariffId]}

âœ… Ð’Ñ‹Ð±Ð¾Ñ€ ÑÐ¾Ñ…Ñ€Ð°Ð½Ñ‘Ð½! ÐœÐµÐ½ÐµÐ´Ð¶ÐµÑ€ ÑÐ²ÑÐ¶ÐµÑ‚ÑÑ Ð´Ð»Ñ ÑƒÑ‚Ð¾Ñ‡Ð½ÐµÐ½Ð¸Ñ Ð´ÐµÑ‚Ð°Ð»ÐµÐ¹.

ðŸ“ž Ð•ÑÐ»Ð¸ Ñƒ Ð²Ð°Ñ ÐµÑÑ‚ÑŒ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹, Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ Ð½Ð°Ð¼!`;

  ctx.reply(message, {
    reply_markup: {
      inline_keyboard: [
        [{
          text: "ðŸ“ž Ð¡Ð²ÑÐ·Ð°Ñ‚ÑŒÑÑ Ñ Ð¼ÐµÐ½ÐµÐ´Ð¶ÐµÑ€Ð¾Ð¼",
          callback_data: "contact_manager"
        }],
        [{
          text: "ðŸŽ¯ Ð—Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒÑÑ Ð½Ð° Ð¿Ñ€Ð¾Ð±Ð½Ð¾Ðµ",
          callback_data: "book_trial"
        }]
      ]
    }
  });
}

// Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ callback Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¸
bot.action('book_trial', (ctx) => {
  ctx.reply(`ðŸ“ Ð”Ð»Ñ Ð·Ð°Ð¿Ð¸ÑÐ¸ Ð½Ð° Ð¿Ñ€Ð¾Ð±Ð½Ð¾Ðµ Ð·Ð°Ð½ÑÑ‚Ð¸Ðµ:

1ï¸âƒ£ ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Ð¼Ð¸Ð½Ð¸-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ
2ï¸âƒ£ ÐŸÑ€Ð¾Ð¹Ð´Ð¸Ñ‚Ðµ ÐºÐ²Ð¸Ð·
3ï¸âƒ£ Ð—Ð°Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ Ñ„Ð¾Ñ€Ð¼Ñƒ Ð·Ð°Ð¿Ð¸ÑÐ¸

Ð˜Ð»Ð¸ ÑÐ²ÑÐ¶Ð¸Ñ‚ÐµÑÑŒ Ñ Ð¼ÐµÐ½ÐµÐ´Ð¶ÐµÑ€Ð¾Ð¼ Ð½Ð°Ð¿Ñ€ÑÐ¼ÑƒÑŽ: @icode_manager`);
});

bot.action('view_tariffs', (ctx) => {
  const tariffsMessage = `ðŸ’° Ð¢Ð°Ñ€Ð¸Ñ„Ñ‹ ÑˆÐºÐ¾Ð»Ñ‹ iKODe:

ðŸš€ Ð¡Ð¢ÐÐ Ð¢ - 4 Ð·Ð°Ð½ÑÑ‚Ð¸Ñ
â€¢ Ð’Ð²Ð¾Ð´Ð½Ñ‹Ð¹ Ð¼Ð¾Ð´ÑƒÐ»ÑŒ
â€¢ Ð‘Ð°Ð·Ð¾Ð²Ñ‹Ðµ Ð½Ð°Ð²Ñ‹ÐºÐ¸
â€¢ ÐŸÐµÑ€Ð²Ñ‹Ð¹ Ð¼Ð¸Ð½Ð¸-Ð¿Ñ€Ð¾ÐµÐºÑ‚
ðŸ’µ Ð¡Ñ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ: ÑƒÑ‚Ð¾Ñ‡Ð½ÑÐ¹Ñ‚Ðµ Ñƒ Ð¼ÐµÐ½ÐµÐ´Ð¶ÐµÑ€Ð°

ðŸ—ï¸ Ð‘ÐÐ—Ð - 8 Ð·Ð°Ð½ÑÑ‚Ð¸Ð¹  
â€¢ Ð Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð½Ð°Ñ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð°
â€¢ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°
â€¢ Ð¡ÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚
ðŸ’µ Ð¡Ñ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ: ÑƒÑ‚Ð¾Ñ‡Ð½ÑÐ¹Ñ‚Ðµ Ñƒ Ð¼ÐµÐ½ÐµÐ´Ð¶ÐµÑ€Ð°

â­ ÐŸÐ Ðž - 12 Ð·Ð°Ð½ÑÑ‚Ð¸Ð¹
â€¢ ÐŸÐ¾Ð»Ð½Ñ‹Ð¹ ÐºÑƒÑ€Ñ
â€¢ 2 Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° Ð² Ð¿Ð¾Ñ€Ñ‚Ñ„Ð¾Ð»Ð¸Ð¾
â€¢ ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ° Ð¿Ð¾ÑÐ»Ðµ ÐºÑƒÑ€ÑÐ°
ðŸ’µ Ð¡Ñ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ: ÑƒÑ‚Ð¾Ñ‡Ð½ÑÐ¹Ñ‚Ðµ Ñƒ Ð¼ÐµÐ½ÐµÐ´Ð¶ÐµÑ€Ð°

ðŸ“ž Ð”Ð»Ñ ÑƒÑ‚Ð¾Ñ‡Ð½ÐµÐ½Ð¸Ñ Ð´ÐµÑ‚Ð°Ð»ÐµÐ¹: @icode_manager`;

  ctx.reply(tariffsMessage, {
    reply_markup: {
      inline_keyboard: [
        [{
          text: "ðŸ“ž Ð£Ð·Ð½Ð°Ñ‚ÑŒ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ",
          callback_data: "contact_manager"
        }],
        [{
          text: "ðŸŽ¯ Ð—Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒÑÑ Ð½Ð° Ð¿Ñ€Ð¾Ð±Ð½Ð¾Ðµ",
          callback_data: "book_trial"
        }]
      ]
    }
  });
});

bot.action('contact_now', (ctx) => {
  ctx.reply(`ðŸ“ž Ð¡Ð²ÑÐ¶Ð¸Ñ‚ÐµÑÑŒ Ñ Ð½Ð°Ð¼Ð¸ Ð¿Ñ€ÑÐ¼Ð¾ ÑÐµÐ¹Ñ‡Ð°Ñ:

ðŸ‘¨â€ðŸ’¼ ÐœÐµÐ½ÐµÐ´Ð¶ÐµÑ€: @icode_manager
ðŸ“± Telegram: @icode_manager
ðŸ“§ Email: info@icode.school

â° Ð’Ñ€ÐµÐ¼Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹: ÐŸÐ½-ÐŸÑ‚ 9:00-18:00

ðŸ’¬ ÐÐ°Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ Ð½Ð°Ð¼, Ð¸ Ð¼Ñ‹ Ð¾Ñ‚Ð²ÐµÑ‚Ð¸Ð¼ Ð² Ñ‚ÐµÑ‡ÐµÐ½Ð¸Ðµ 15 Ð¼Ð¸Ð½ÑƒÑ‚!`);
});

// ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¾ÑˆÐ¸Ð±Ð¾Ðº
bot.catch((err, ctx) => {
  console.error('ÐžÑˆÐ¸Ð±ÐºÐ° Ð±Ð¾Ñ‚Ð°:', err);
  ctx.reply('âŒ ÐŸÑ€Ð¾Ð¸Ð·Ð¾ÑˆÐ»Ð° Ð¾ÑˆÐ¸Ð±ÐºÐ°. ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ ÐµÑ‰Ñ‘ Ñ€Ð°Ð· Ð¸Ð»Ð¸ Ð¾Ð±Ñ€Ð°Ñ‚Ð¸Ñ‚ÐµÑÑŒ Ðº Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ñƒ.');
});

// Ð—Ð°Ð¿ÑƒÑÐº Ð±Ð¾Ñ‚Ð°
bot.launch()
  .then(() => {
    console.log('ðŸ¤– Ð‘Ð¾Ñ‚ iKODe ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½!');
    console.log('ðŸ“± Username: @IKODe_app_bot');
    console.log('ðŸŒ ÐœÐ¸Ð½Ð¸-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ: https://denis90-ctrl.github.io/icode/');
  })
  .catch((error) => {
    console.error('âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð¿ÑƒÑÐºÐ° Ð±Ð¾Ñ‚Ð°:', error);
  });

// Graceful stop
process.once('SIGINT', () => bot.stop('SIGINT'));
process.once('SIGTERM', () => bot.stop('SIGTERM'));
